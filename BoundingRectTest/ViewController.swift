import UIKit

class ViewController: UIViewController {
    
    @IBOutlet var label: UILabel!

    override func viewDidLoad() {
        super.viewDidLoad()
        // Do any additional setup after loading the view.
    }
    
    @IBAction func tapButton() {
        let test = NSAttributedString(string: testString)
        _ = textViewHeight(width: self.view.bounds.width, height: CGFloat.greatestFiniteMagnitude, attributeText: test)
    }

    // NOTE: Compare iOS 15.2 with iOS 15.1 or lower versions.
    private func textViewHeight(width: CGFloat, height: CGFloat, attributeText: NSAttributedString) -> CGFloat {
        let time = Date()
        let result = ceil(attributeText.boundingRect(
            with: CGSize(width: width, height: height),
            options: [.usesLineFragmentOrigin, ],
            context: nil).height)
        let computationTime = floor((time.timeIntervalSinceNow * -1) / 10 * 1000) / 1000
        print("Result height: \(result)  Computation time: \(computationTime) seconds")
        label.text = "Computation time: \(computationTime) seconds"
        return result
    }
}

/// 700 lines
private let testString = """
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
あ
い
う
え
お
"""
